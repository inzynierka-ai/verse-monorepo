# Verse Backend

A FastAPI-based backend application that enables real-time character interactions using WebSocket connections and OpenAI's GPT models.

## Features

- RESTful API using FastAPI framework
- Real-time WebSocket connections for character interactions
- Integration with OpenAI's GPT models
- PostgreSQL database with SQLAlchemy ORM
- Authentication and authorization
- Langfuse integration for LLM monitoring

## Prerequisites

- Python 3.8+
- PostgreSQL database
- OpenAI API key (or OpenRouter API access)
- Docker and Docker Compose (for containerized setup)

## Installation

### Local Development Setup

1. Clone the repository
2. Create and activate virtual environment:

```bash
python -m venv venv
source venv/bin/activate  # Unix
venv\Scripts\activate     # Windows
```

3. Install dependencies:

```bash
pip install -r requirements.txt
```

4. Create a `.env` file based on `.env.example` with your configuration:

5. Start the development server:

```bash
uvicorn app.main:app --reload
```

### Docker Setup

The application can be run using Docker Compose:

1. Make sure Docker and Docker Compose are installed
2. Create `.env` file with proper configuration
3. Run from the root directory:

```bash
docker-compose up
```

Or to run just the backend:

```bash
docker-compose up backend
```

## Database Migrations

This project uses Alembic for database migrations.

- Generate a migration:
```bash
docker exec -it verse-backend-web-1 alembic revision --autogenerate -m "message"
```
You might want to check the autogenerated migration file in `/alembic/versions`

- Run migrations:
```bash
docker exec -it verse-backend-web-1 alembic upgrade head
```

## API Documentation

Once the server is running, you can access:
- Interactive API documentation: http://localhost:8000/docs
- Alternative API documentation: http://localhost:8000/redoc
- Health check endpoint: http://localhost:8000/health


To run migrations:
- generate migration by running:
    docker exec -it verse-monorepo-backend-1 alembic revision --autogenerate -m "message"
You might want to check the autogenerated migration file in /alembic/versions
- run migration by running:
    docker exec -it verse-monorepo-backend-1 alembic upgrade head
